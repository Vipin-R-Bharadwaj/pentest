import subprocess
from utils.tool_registry import register_tool
from utils.util_functions import ensure_url_scheme

import os

def whatweb_scan(endpoint):
    current_directory = os.getcwd()
    exe_path = f"{current_directory}/executables/whatweb"

    try: 
        result = subprocess.run([exe_path, "-v", ensure_url_scheme(endpoint)], check=True, capture_output=True, text=True) 
        print("Output:", result.stdout)
        return result
    except subprocess.CalledProcessError as e: 
        print("An error occurred while running the .exe file.") 
        print("Return Code:", e.returncode) 
        print("Output:", e.output) 
        print("Error Output:", e.stderr) 
        return e

def categorize_whatweb_results(results):
    print(results)
    return {}

register_tool('whatweb', whatweb_scan, categorize_whatweb_results)