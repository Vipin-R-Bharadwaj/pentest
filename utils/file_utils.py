import os.path
from utils.util_functions import getDateTime

def read_endpoints(file_path):
    """
    This function reads endpoints from a file where each line contains an endpoint URL.
    """
    with open(file_path, 'r') as f:
        endpoints = f.read().splitlines()
    return endpoints

def clean_xml_file(file_path):
    with open(file_path, 'r') as f:
        lines = f.readlines()

    clean_lines = []
    for line in lines:
        clean_lines.append(line)
        if "</niktoscan>" in line:
            break

    with open(file_path, 'w') as f:
        f.writelines(clean_lines)

def generate_markdown_report(endpoint, categorized_results):
    report = f"# VAPT Report for {endpoint}\n\n"
    for level, findings in categorized_results.items():
        report += f"## {level.capitalize()} Vulnerabilities\n\n"
        for finding in findings:
            report += f"- {finding}\n"
    return report

def create_report(file_name, data):
    current_directory = os.getcwd()
    subdirectory = f"{current_directory}/reports"

    try:
        # Create the directory if it doesn't exist 
        os.makedirs(subdirectory, exist_ok=True) 

        # Create the file inside the directory 
        file_path = os.path.join(subdirectory, f"{file_name}_{getDateTime()}_vapt_report.md") 
        with open(file_path, 'w') as f:
            f.write(data)
        print(f"File saved at {file_path}.")
        return True
    except Exception:
        print(f"Exception while generating report: {Exception}")
        return False
